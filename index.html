<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Shadowverse カード検索</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Shadowverse カード検索</h1>
<input type="text" id="searchInput" placeholder="カード名を入力..." />

<div id="results"></div>

<button id="random">random</button>
<button id="aaa">漢あア変換</button>

<div id="rResults"></div>

<footer>
  <a href="aaa.html" target="_blank">あああ</a>
</footer>
<script>
    let cards = [];
    
    // JSONを読み込み
    fetch('cards.json')
      .then(response => response.json())
      .then(data => {
        cards = data.data.cards.filter(card => 
          String(card.card_id).substr(0,3) == "910" && card.resource_card_id == 0 || card.card_name != null && !["910", "810"].includes(String(card.card_id).substr(0,3)) && !["930", "810", "800"].includes(String(card.base_card_id).substr(0,3)))
        //最初の三桁 930:ヒーローズバトル 800:アクセラレート 810:テキスト変更前 910:レーヴァテインドラゴン
        setupSearch();
      });
    
    // 検索処理
    function setupSearch() {
      const input = document.getElementById('searchInput');
      const results = document.getElementById('results');
    
      input.addEventListener('input', () => {
        const keyword = input.value.trim().toLowerCase();
        results.innerHTML = '';
    
        const filtered = cards.filter(card => 
          card.card_name && card.card_name.toLowerCase().includes(keyword)
        );
    
        filtered.slice(0, 20).forEach(card => {
          const div = document.createElement('div');
          div.className = 'card';
          div.innerHTML = `
            <strong>${card.card_name}</strong><br/>
            コスト: ${card.cost} / 攻撃: ${card.atk} / 体力: ${card.life} / ID: ${card.card_id}
          `;
          results.appendChild(div);
        });
      });
    }
    const r_button = document.querySelector("#random")
    r_button.addEventListener("click", () => {
      //カード名
      document.querySelector("#rResults").innerHTML = ""
      const name = document.createElement("div")

      //カードが存在する乱数生成
      const random = Math.floor(Math.random()*cards.length)
      const card = cards[random]
      
      //カード名追加
      name.innerHTML = `${card.card_name} : ${card.card_id}`
      document.querySelector("#rResults").appendChild(name)

      //画像追加
      const img = document.createElement("img")
      img.width = 200
      if(String(card.card_id).substr(0,3) != "910"){
        img.src = `https://shadowverse-portal.com/image/card/phase2/common/C/C_${card.card_id}.png`
      }else{
        img.src = `https://shadowverse-portal.com/image/card/phase2/common/C/C_${card.base_card_id}.png`
      }
      img.onload = () => {
        document.querySelector("#rResults").appendChild(img)}
      
      if(card.atk){
        const imgE = document.createElement("img")
        imgE.width = 200
        imgE.src = `https://shadowverse-portal.com/image/card/phase2/common/E/E_${card.card_id}.png`
        imgE.onload = () => {
          document.querySelector("#rResults").appendChild(imgE)
        }
      }


      //テキスト追加
      const text = document.createElement("div")
      let status = card.cost
      if(card.atk){
        status = card.cost + "/" + card.atk + "/" + card.life + `(${card.evo_atk}/${card.evo_life})`
        text.innerHTML = `${status} <br> 進化前 <br> ${card.skill_disc}
      <br><br> 進化後 <br>${card.evo_skill_disc}`
      }else{
        text.innerHTML = `${status} <br> ${card.skill_disc}`
      }
      document.querySelector("#rResults").appendChild(text)


      //フレーバーテキスト追加
      const disc = document.createElement("div")
      if(card.atk){
        disc.innerHTML = `進化前 <br> ${card.description} <br><br> 進化後 <br> ${card.evo_description}`
      }else{
        disc.innerHTML = `${card.description}`
      }
      document.querySelector("#rResults").appendChild(disc)

    })

    const aaa_button = document.querySelector("#aaa")
    aaa_button.addEventListener("click", () => {
      const aaa_a = document.createElement("a");
      aaa_a.href = "aaa.html";
      aaa_a.click();
    })
</script>
    